<h2 mat-dialog-title>Detalle de Lote {{ data.numero || "Cargando..." }}</h2>
<mat-dialog-content class="mat-typography m-t-24">
  <mat-card class="cardWithShadow">
    <mat-card-content>
      <mat-stepper linear [selectedIndex]="0" class="m-b-12">
        <mat-step label="Información del Lote">
          <ng-template matStepLabel>
            <span class="mat-subtitle-1 f-w-600">Información del Lote</span>
          </ng-template>
          <div class="row">
            <form>
              <mat-form-field
                appearance="outline"
                class="w-50 m-8"
                color="primary"
              >
                <mat-label class="m-t-8 mat-subtitle-2 f-w-600 m-b-8 d-block"
                  >Tipo de Transporte</mat-label
                >
                <input matInput readonly type="text" [value]="tipoTransporte" />
              </mat-form-field>

              <mat-form-field
                appearance="outline"
                class="w-50 m-8"
                color="primary"
              >
                <mat-label class="m-t-8 mat-subtitle-2 f-w-600 m-b-8 d-block"
                  >Nombre de Nave</mat-label
                >
                <input
                  matInput
                  readonly
                  type="text"
                  [value]="data.lote?.nombreNave"
                />
              </mat-form-field>

              <mat-form-field
                appearance="outline"
                class="w-50 m-8"
                color="primary"
              >
                <mat-label class="m-t-8 mat-subtitle-2 f-w-600 m-b-8 d-block"
                  >Bodega de Nave</mat-label
                >
                <input
                  matInput
                  readonly
                  type="text"
                  [value]="data.lote?.bodegaNave"
                />
              </mat-form-field>

              <mat-form-field
                appearance="outline"
                class="w-50 m-8"
                color="primary"
              >
                <mat-label class="m-t-8 mat-subtitle-2 f-w-600 m-b-8 d-block"
                  >Observación</mat-label
                >
                <input
                  matInput
                  type="text"
                  [(ngModel)]="lote.observacion"
                  name="observacion"
                />
              </mat-form-field>

              <mat-form-field
                appearance="outline"
                class="w-50 m-8"
                color="primary"
              >
                <mat-label class="m-t-8 mat-subtitle-2 f-w-600 m-b-8 d-block"
                  >Total de Sublotes</mat-label
                >
                <input
                  matInput
                  readonly
                  type="text"
                  [value]="lote?.cantSubLotes || 0 + ' Sublotes'"
                />
              </mat-form-field>

              <mat-form-field
                appearance="outline"
                class="w-50 m-8"
                color="primary"
              >
                <mat-label class="m-t-8 mat-subtitle-2 f-w-600 m-b-8 d-block"
                  >Fecha del Primer Registro</mat-label
                >
                <input
                  matInput
                  readonly
                  type="text"
                  [value]="fechaPrimerRegistro | date : 'yyyy-MM-dd'"
                />
              </mat-form-field>

              <mat-form-field
                appearance="outline"
                class="w-50 m-8"
                color="primary"
              >
                <mat-label class="m-t-8 mat-subtitle-2 f-w-600 m-b-8 d-block"
                  >Fecha del Último Registro</mat-label
                >
                <input
                  matInput
                  readonly
                  type="text"
                  [value]="fechaUltimoRegistro | date : 'yyyy-MM-dd'"
                />
              </mat-form-field>

              <mat-form-field
                appearance="outline"
                class="w-50 m-8"
                color="primary"
              >
                <mat-label class="m-t-8 mat-subtitle-2 f-w-600 m-b-8 d-block"
                  >Hora del Primer Registro</mat-label
                >
                <input
                  matInput
                  readonly
                  type="text"
                  [value]="horaPrimerRegistro"
                />
              </mat-form-field>

              <mat-form-field
                appearance="outline"
                class="w-50 m-8"
                color="primary"
              >
                <mat-label class="m-t-8 mat-subtitle-2 f-w-600 m-b-8 d-block"
                  >Hora del Último Registro</mat-label
                >
                <input
                  matInput
                  readonly
                  type="text"
                  [value]="horaUltimoRegistro"
                />
              </mat-form-field>

              <mat-form-field
                appearance="outline"
                class="w-50 m-8"
                color="primary"
              >
                <mat-label class="m-t-8 mat-subtitle-2 f-w-600 m-b-8 d-block"
                  >Fecha de Lote</mat-label
                >
                <input
                  matInput
                  readonly
                  type="text"
                  [value]="lote?.fLote | date : 'yyyy-MM-dd'"
                />
              </mat-form-field>

              <mat-form-field
                appearance="outline"
                class="w-50 m-8"
                color="primary"
              >
                <mat-label class="m-t-8 mat-subtitle-2 f-w-600 m-b-8 d-block"
                  >Peso Lote</mat-label
                >
                <input
                  matInput
                  readonly
                  type="text"
                  [value]="sumaPesos.toFixed(2) + ' Ton'"
                />
              </mat-form-field>

              <mat-form-field
                appearance="outline"
                class="w-50 m-8"
                color="primary"
              >
                <mat-label class="m-t-8 mat-subtitle-2 f-w-600 m-b-8 d-block"
                  >Peso Seco</mat-label
                >
                <input
                  matInput
                  readonly
                  type="text"
                  [value]="lote?.pesoNetoSeco + ' Ton'"
                />
              </mat-form-field>

              <mat-form-field
                appearance="outline"
                class="w-50 m-8"
                color="primary"
              >
                <mat-label class="m-t-8 mat-subtitle-2 f-w-600 m-b-8 d-block"
                  >% Cobre Embarque</mat-label
                >
                <input
                  matInput
                  type="number"
                  [(ngModel)]="lote.CuOrigen"
                  (input)="actualizarCuOrigen($event)"
                  name="CuOrigen"
                />
              </mat-form-field>

              <mat-form-field
                appearance="outline"
                class="w-50 m-8"
                color="primary"
              >
                <mat-label class="m-t-8 mat-subtitle-2 f-w-600 m-b-8 d-block"
                  >Cobre Fino</mat-label
                >
                <input
                  matInput
                  readonly
                  type="text"
                  [value]="lote?.CuFino + ' Ton'"
                  (input)="actualizarCuFino($event)"
                />
              </mat-form-field>
            </form>
            <div class="col" style="display: flex; justify-content: flex-end">
              <button
                mat-flat-button
                *ngIf="admin || operator || encargado"
                (click)="actualizarLote()"
                color="primary"
                class="m-t-8 m-b-8"
              >
                Actualizar Lote
              </button>
            </div>
          </div>
        </mat-step>
        <mat-step label="Información del Embarque">
          <ng-template matStepLabel>
            <span class="mat-subtitle-1 f-w-600">Información del Embarque</span>
          </ng-template>
          <div class="row">
            <mat-form-field
              appearance="outline"
              class="w-50 m-8"
              color="primary"
            >
              <mat-label class="m-t-8 mat-subtitle-2 f-w-600 m-b-8 d-block"
                >N° DUS</mat-label
              >
              <input matInput type="text" [(ngModel)]="lote.DUS" name="DUS" />
            </mat-form-field>
            <mat-form-field
              appearance="outline"
              class="w-50 m-8"
              color="primary"
            >
              <mat-label class="m-t-8 mat-subtitle-2 f-w-600 m-b-8 d-block"
                >Fecha DUS</mat-label
              >
              <input
                matInput
                type="date"
                [(ngModel)]="lote.fechaDUS"
                name="fechaDUS"
                (change)="actualizarFechaDUS($event)"
              />
            </mat-form-field>
            <mat-form-field
              appearance="outline"
              class="w-50 m-8"
              color="primary"
            >
              <mat-label class="m-t-8 mat-subtitle-2 f-w-600 m-b-8 d-block"
                >Lista Verificación</mat-label
              >
              <input
                matInput
                type="text"
                [(ngModel)]="lote.listaVerificacion"
                name="listaVerificacion"
              />
            </mat-form-field>
            <mat-form-field
              appearance="outline"
              class="w-50 m-8"
              color="primary"
            >
              <mat-label class="m-t-8 mat-subtitle-2 f-w-600 m-b-8 d-block"
                >Referencia Focus</mat-label
              >
              <input
                matInput
                type="text"
                [(ngModel)]="lote.refFocus"
                name="refFocus"
              />
            </mat-form-field>
            <mat-form-field
              appearance="outline"
              class="w-50 m-8"
              color="primary"
            >
              <mat-label class="m-t-8 mat-subtitle-2 f-w-600 m-b-8 d-block"
                >Calidad</mat-label
              >
              <!-- Select con los valores de LOS BRONCES, SOLDADO, BLEND -->
              <mat-select
                matInput
                placeholder="Seleccione una calidad"
                [(ngModel)]="lote.calidad"
                name="calidad"
              >
                <mat-option value="LOS BRONCES">LOS BRONCES</mat-option>
                <mat-option value="SOLDADO">SOLDADO</mat-option>
                <mat-option value="BLEND">BLEND</mat-option>
              </mat-select>
            </mat-form-field>
            <mat-form-field
              appearance="outline"
              class="w-50 m-8"
              color="primary"
            >
              <mat-label class="m-t-8 mat-subtitle-2 f-w-600 m-b-8 d-block"
                >Cliente</mat-label
              >
              <input
                matInput
                type="text"
                [(ngModel)]="lote.cliente"
                name="cliente"
              />
            </mat-form-field>
            <mat-form-field
              appearance="outline"
              class="w-50 m-8"
              color="primary"
            >
              <mat-label class="m-t-8 mat-subtitle-2 f-w-600 m-b-8 d-block"
                >Cu Origen</mat-label
              >
              <input
                matInput
                type="number"
                [(ngModel)]="lote.CuOrigen"
                name="CuOrigen2"
              />
            </mat-form-field>
            <mat-form-field
              appearance="outline"
              class="w-50 m-8"
              color="primary"
            >
              <mat-label class="m-t-8 mat-subtitle-2 f-w-600 m-b-8 d-block"
                >Cu Destino</mat-label
              >
              <input
                matInput
                type="number"
                [(ngModel)]="lote.CuDestino"
                name="CuDestino"
              />
            </mat-form-field>
            <mat-form-field
              appearance="outline"
              class="w-50 m-8"
              color="primary"
            >
              <mat-label class="m-t-8 mat-subtitle-2 f-w-600 m-b-8 d-block"
                >Fecha Termino</mat-label
              >
              <input
                matInput
                type="date"
                [(ngModel)]="lote.fechaTermino"
                name="fechaTermino"
              />
            </mat-form-field>
            <mat-form-field
              appearance="outline"
              class="w-50 m-8"
              color="primary"
            >
              <mat-label class="m-t-8 mat-subtitle-2 f-w-600 m-b-8 d-block"
                >Contrato Cochilco</mat-label
              >
              <input
                matInput
                type="text"
                [(ngModel)]="lote.contratoCochilco"
                name="contratoCochilco"
              />
            </mat-form-field>
            <mat-form-field
              appearance="outline"
              class="w-50 m-8"
              color="primary"
            >
              <mat-label class="m-t-8 mat-subtitle-2 f-w-600 m-b-8 d-block"
                >Contrato Anglo</mat-label
              >
              <input
                matInput
                type="text"
                [(ngModel)]="lote.contratoAnglo"
                name="contratoAnglo"
              />
            </mat-form-field>
            <mat-form-field
              appearance="outline"
              class="w-50 m-8"
              color="primary"
            >
              <mat-label class="m-t-8 mat-subtitle-2 f-w-600 m-b-8 d-block"
                >DV</mat-label
              >
              <input matInput type="text" [(ngModel)]="lote.DV" name="DV" />
            </mat-form-field>
            <mat-form-field
              appearance="outline"
              class="w-50 m-8"
              color="primary"
            >
              <mat-label class="m-t-8 mat-subtitle-2 f-w-600 m-b-8 d-block"
                >Fecha Envio reporte</mat-label
              >
              <input
                matInput
                type="date"
                [(ngModel)]="lote.fechaEnvioReporte"
                name="fechaEnvioReporte"
              />
            </mat-form-field>
            <mat-form-field
              appearance="outline"
              class="w-50 m-8"
              color="primary"
            >
              <mat-label class="m-t-8 mat-subtitle-2 f-w-600 m-b-8 d-block"
                >Fecha Entrega Laboratorio</mat-label
              >
              <input
                matInput
                type="date"
                [(ngModel)]="lote.fechaEntregaLab"
                name="fechaEntregaLab"
              />
            </mat-form-field>
            <mat-form-field
              appearance="outline"
              class="w-50 m-8"
              color="primary"
            >
              <mat-label class="m-t-8 mat-subtitle-2 f-w-600 m-b-8 d-block"
                >DUS Avance Composito</mat-label
              >
              <input
                matInput
                type="date"
                [(ngModel)]="lote.DUSAvanceComposito"
                name="DUSAvanceComposito"
              />
            </mat-form-field>
            <mat-form-field
              appearance="outline"
              class="w-50 m-8"
              color="primary"
            >
              <mat-label class="m-t-8 mat-subtitle-2 f-w-600 m-b-8 d-block"
                >DUS Finales</mat-label
              >
              <input
                matInput
                type="date"
                [(ngModel)]="lote.DUSFinales"
                name="DUSFinales"
              />
            </mat-form-field>
            <mat-form-field
              appearance="outline"
              class="w-50 m-8"
              color="primary"
            >
              <mat-label class="m-t-8 mat-subtitle-2 f-w-600 m-b-8 d-block"
                >Lote a Lote finales</mat-label
              >
              <input
                matInput
                type="date"
                [(ngModel)]="lote.LALFinales"
                name="LALFinales"
              />
            </mat-form-field>
            <mat-form-field
              appearance="outline"
              class="w-50 m-8"
              color="primary"
            >
              <mat-label class="m-t-8 mat-subtitle-2 f-w-600 m-b-8 d-block"
                >Fecha Entrega Lab Aduana</mat-label
              >
              <input
                matInput
                type="date"
                [(ngModel)]="lote.fechaEntregaLabAduana"
                name="fechaEntregaLabAduana"
              />
            </mat-form-field>
            <mat-form-field
              appearance="outline"
              class="w-50 m-8"
              color="primary"
            >
              <mat-label class="m-t-8 mat-subtitle-2 f-w-600 m-b-8 d-block"
                >Lugar Descarga</mat-label
              >
              <input
                matInput
                type="text"
                [(ngModel)]="lote.lugarDescarga"
                name="lugarDescarga"
              />
            </mat-form-field>
            <mat-form-field
              appearance="outline"
              class="w-50 m-8"
              color="primary"
            >
              <mat-label class="m-t-8 mat-subtitle-2 f-w-600 m-b-8 d-block"
                >País Descarga</mat-label
              >
              <input
                matInput
                type="text"
                [(ngModel)]="lote.paisDescarga"
                name="paisDescarga"
              />
            </mat-form-field>
            <mat-form-field
              appearance="outline"
              class="w-50 m-8"
              color="primary"
            >
              <mat-label class="m-t-8 mat-subtitle-2 f-w-600 m-b-8 d-block"
                >Resguardo Testigo Aduana</mat-label
              >
              <input
                matInput
                type="text"
                [(ngModel)]="lote.resguardoTestigoAduana"
                name="resguardoTestigoAduana"
              />
            </mat-form-field>
            <mat-form-field
              appearance="outline"
              class="w-50 m-8"
              color="primary"
            >
              <mat-label class="m-t-8 mat-subtitle-2 f-w-600 m-b-8 d-block"
                >N° Resolución SNA</mat-label
              >
              <input
                matInput
                type="text"
                [(ngModel)]="lote.numResolucionSNA"
                name="numResolucionSNA"
              />
            </mat-form-field>
            <mat-form-field
              appearance="outline"
              class="w-50 m-8"
              color="primary"
            >
              <mat-label class="m-t-8 mat-subtitle-2 f-w-600 m-b-8 d-block"
                >Exportador</mat-label
              >
              <input
                matInput
                type="text"
                [(ngModel)]="lote.exportador"
                name="exportador"
              />
            </mat-form-field>
            <mat-form-field
              appearance="outline"
              class="w-50 m-8"
              color="primary"
            >
              <mat-label class="m-t-8 mat-subtitle-2 f-w-600 m-b-8 d-block"
                >Aduana</mat-label
              >
              <input
                matInput
                type="text"
                [(ngModel)]="lote.aduana"
                name="aduana"
              />
            </mat-form-field>
            <mat-form-field
              appearance="outline"
              class="w-50 m-8"
              color="primary"
            >
              <mat-label class="m-t-8 mat-subtitle-2 f-w-600 m-b-8 d-block"
                >Registro INN</mat-label
              >
              <input
                matInput
                type="text"
                [(ngModel)]="lote.registroINN"
                name="registroINN"
              />
            </mat-form-field>
            <mat-form-field
              appearance="outline"
              class="w-50 m-8"
              color="primary"
            >
              <mat-label class="m-t-8 mat-subtitle-2 f-w-600 m-b-8 d-block"
                >Rut Exportador</mat-label
              >
              <input
                matInput
                type="text"
                [(ngModel)]="lote.rutExportador"
                name="rutExportador"
              />
            </mat-form-field>
          </div>
          <div class="col" style="display: flex; justify-content: flex-end">
            <button
              mat-flat-button
              *ngIf="admin || operator || encargado"
              (click)="actualizarLote()"
              color="primary"
              class="m-t-8 m-b-8"
            >
              Actualizar Lote
            </button>
            <button
              mat-flat-button
              (click)="descargarEtiquetasEmbarques()"
              *ngIf="admin || operator || encargado"
              color="primary"
              class="m-t-8 m-b-8"
              style="margin-left: 10px"
            >
              Etiquetas Embarques
            </button>
          </div>
        </mat-step>
      </mat-stepper>
      <mat-divider></mat-divider>
      <mat-card-title *ngIf="admin || operator" class="m-t-12"
        >Crear registro</mat-card-title
      >
      <div *ngIf="admin || operator || encargado" class="row">
        <div class="col">
          <button
            mat-flat-button
            *ngIf="admin || operator || encargado"
            (click)="crearRegistro()"
            color="primary"
            class="m-t-8 m-b-8"
          >
            Nuevo registro
          </button>
          <mat-form-field appearance="outline" class="w-50 m-8" color="primary">
            <mat-label class="m-t-8 mat-subtitle-2 f-w-600 m-b-8 d-block"
              >Bodegas</mat-label
            >
            <mat-select
              matInput
              placeholder="Seleccione una bodega"
              [(ngModel)]="bodegaSeleccionada"
              name="bodegaSeleccionada"
              (selectionChange)="onBodegaChange($event)"
            >
              <mat-option *ngFor="let bodega of bodegas" [value]="bodega">
                {{ bodega.nombreBodega }}
              </mat-option>
            </mat-select>
          </mat-form-field>
          <mat-form-field appearance="outline" class="w-50 m-8" color="primary">
            <mat-label class="m-t-8 mat-subtitle-2 f-w-600 m-b-8 d-block"
              >Material disponible</mat-label
            >
            <input readonly matInput [(ngModel)]="total" />
          </mat-form-field>
          <button
            mat-flat-button
            *ngIf="admin || operator || encargado"
            (click)="generarCertificados()"
            color="primary"
            class="m-t-8 m-b-8 m-l-32"
          >
            Generar certificados
          </button>
        </div>
      </div>
      <div class="row">
        <!-- TABLA DE CAMIONES -->
        <mat-card>
          <mat-card-header class="m-8">
            <mat-card-title>Lista de Sublotes registrados</mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <table
              mat-table
              [dataSource]="dataSource1"
              class="mat-elevation-z8"
            >
              <!-- Columna N° Lote -->
              <ng-container matColumnDef="nLote">
                <th mat-header-cell *matHeaderCellDef>N° Sublote</th>
                <td mat-cell *matCellDef="let element; let i = index">
                  {{ i + 1 }}
                </td>
              </ng-container>

              <!-- Columna Fecha Inicial -->
              <ng-container matColumnDef="fechaInicial">
                <th mat-header-cell *matHeaderCellDef>Fecha Inicial</th>
                <td mat-cell *matCellDef="let element">
                  {{ element.fechaInicial | date }}
                </td>
              </ng-container>

              <!-- Columna Hora Inicial -->
              <ng-container matColumnDef="horaInicial">
                <th mat-header-cell *matHeaderCellDef>Hora Inicial</th>
                <td mat-cell *matCellDef="let element">
                  {{ element.horaInicial }}
                </td>
              </ng-container>

              <!-- Columna Fecha Final -->
              <ng-container matColumnDef="fechaFinal">
                <th mat-header-cell *matHeaderCellDef>Fecha Final</th>
                <td mat-cell *matCellDef="let element">
                  {{ element.fechaFinal | date }}
                </td>
              </ng-container>

              <!-- Columna Hora Final -->
              <ng-container matColumnDef="horaFinal">
                <th mat-header-cell *matHeaderCellDef>Hora Final</th>
                <td mat-cell *matCellDef="let element">
                  {{ element.horaFinal }}
                </td>
              </ng-container>

              <!-- Columna Peso Lote -->
              <ng-container matColumnDef="pesoLote">
                <th mat-header-cell *matHeaderCellDef>Peso Lote</th>
                <td mat-cell *matCellDef="let element">
                  {{ element.pesoLote }}
                </td>
              </ng-container>

              <!-- Columna Porcentaje Humedad -->
              <ng-container matColumnDef="porcHumedad">
                <th mat-header-cell *matHeaderCellDef>Porcentaje Humedad</th>
                <td mat-cell *matCellDef="let element">
                  {{ element.porcHumedad }}
                </td>
              </ng-container>

              <!-- Columna Estado -->
              <ng-container matColumnDef="estado">
                <th mat-header-cell *matHeaderCellDef>Estado</th>
                <td
                  mat-cell
                  *matCellDef="let element"
                  [ngClass]="{
                    'estado-aprobado': element.estado === 'aprobado',
                    'estado-pendiente': element.estado === 'pendiente',
                    'estado-error': element.estado === 'error'
                  }"
                >
                  {{ element.estado }}
                </td>
              </ng-container>

              <tr
                mat-header-row
                *matHeaderRowDef="[
                  'nLote',
                  'fechaInicial',
                  'horaInicial',
                  'fechaFinal',
                  'horaFinal',
                  'pesoLote',
                  'porcHumedad',
                  'estado'
                ]"
              ></tr>
              <tr
                mat-row
                *matRowDef="
                  let row;
                  columns: [
                    'nLote',
                    'fechaInicial',
                    'horaInicial',
                    'fechaFinal',
                    'horaFinal',
                    'pesoLote',
                    'porcHumedad',
                    'estado'
                  ]
                "
                (click)="abrirDialogoModificarRegistro(row)"
              ></tr>
            </table>
          </mat-card-content>
        </mat-card>
      </div>
    </mat-card-content>
  </mat-card>
</mat-dialog-content>
