<!-- muestra todas los sobres -->
<mat-card class="cardWithShadow" *ngIf="data.opcion === 1">

  <mat-card-header>
    <div class="d-flex align-items-center w-100 mb-2">
      <mat-card-title class="mb-0">Sobres del Lote: {{ referencia || "Cargando..." }}</mat-card-title>

      <div style="margin-left: auto; display: flex; gap: 8px;">
        <button mat-flat-button color="primary" (click)="descargarExcelTrazabilidad(data.nLote)">
          Descargar excel
        </button>

        <button mat-flat-button color="accent" (click)="tuFuncion(data.nLote, 2, 3)">
          Mover Sobres
        </button>
      </div>
    </div>
  </mat-card-header>

  <mat-card-content class="p-24">
    <mat-tab-group mat-stretch-tabs="false" mat-align-tabs="center" [selectedIndex]="0">
      <mat-tab label="Sobres Externos" class="f-s-16 f-w-600">
        <div class="table-responsive">
          <table mat-table [dataSource]="dataSourceExternos" class="w-100">
            <ng-container matColumnDef="subLote">
              <th mat-header-cell *matHeaderCellDef class="f-s-16 f-w-600">N° SubLote</th>
              <td mat-cell *matCellDef="let element">
                <div>
                  <p class="mat-subtitle-1 f-s-14 m-t-0">
                    {{ element.nSubLote }}
                  </p>
                </div>
              </td>
            </ng-container>

            <ng-container matColumnDef="fid">
              <th mat-header-cell *matHeaderCellDef class="f-s-16 f-w-600">Fecha Instrucción de Despacho</th>
              <td mat-cell *matCellDef="let element">
                <div>
                  <p class="mat-subtitle-1 f-s-14 m-t-0">
                    {{ element.fechaInstruccionDespacho || 'No iniciado' }}
                  </p>
                </div>
              </td>
            </ng-container>

            <ng-container matColumnDef="fcd">
              <th mat-header-cell *matHeaderCellDef class="f-s-16 f-w-600">Fecha Confirmación de Despacho</th>
              <td mat-cell *matCellDef="let element">
                <div>
                  <p class="mat-subtitle-1 f-s-14 m-t-0">
                    {{ element.fechaConfirmacionDespacho || 'No iniciado' }}
                  </p>
                </div>
              </td>
            </ng-container>

            <ng-container matColumnDef="fd">
              <th mat-header-cell *matHeaderCellDef class="f-s-16 f-w-600">Fecha de Despacho</th>
              <td mat-cell *matCellDef="let element">
                <div>
                  <p class="mat-subtitle-1 f-s-14 m-t-0">
                    {{ element.fechaDespacho || 'No iniciado' }}
                  </p>
                </div>
              </td>
            </ng-container>

            <ng-container matColumnDef="observacion">
              <th mat-header-cell *matHeaderCellDef class="f-s-16 f-w-600">
                Observación
              </th>
              <td mat-cell *matCellDef="let element" class="f-s-14">{{ element.observacion }}</td>
            </ng-container>

            <ng-container matColumnDef="numguia">
              <th mat-header-cell *matHeaderCellDef class="f-s-16 f-w-600">
                N° de Guía
              </th>
              <td mat-cell *matCellDef="let element" class="f-s-14">{{ element.numeroGuia || 'No iniciado'}}</td>
            </ng-container>

            <ng-container matColumnDef="lab">
              <th mat-header-cell *matHeaderCellDef class="f-s-16 f-w-600">
                Laboratorio
              </th>
              <td mat-cell *matCellDef="let element" class="f-s-14">{{ element.laboratorio || 'No iniciado' }}</td>
            </ng-container>

            <ng-container matColumnDef="fll">
              <th mat-header-cell *matHeaderCellDef class="f-s-16 f-w-600">Fecha estimada de Llegada al Laboratorio</th>
              <td mat-cell *matCellDef="let element">
                <div>
                  <p class="mat-subtitle-1 f-s-14 m-t-0">
                    {{ element.fechaLlegadaLaboratorio || 'No iniciado' }}
                  </p>
                </div>
              </td>
            </ng-container>

            <ng-container matColumnDef="pais">
              <th mat-header-cell *matHeaderCellDef class="f-s-16 f-w-600">
                País
              </th>
              <td mat-cell *matCellDef="let element" class="f-s-14">{{ element.pais || 'No iniciado' }}</td>
            </ng-container>

            <ng-container matColumnDef="estado">
              <th mat-header-cell *matHeaderCellDef class="f-s-16 f-w-600">
                Estado
              </th>
              <td mat-cell *matCellDef="let element" class="f-s-14">
                {{ element.numeroGuia ? 'Despachado' : 'En preparación' }}
              </td>
            </ng-container>

            <ng-container matColumnDef="opciones">
              <th mat-header-cell *matHeaderCellDef class="f-s-16 f-w-600">
                Opciones
              </th>
              <td mat-cell *matCellDef="let element" class="action-link">
                <!-- <a class="m-r-10 cursor-pointer"><i-tabler name="qrcode" class="icon-18"></i-tabler></a> -->
                <a class="m-r-10 cursor-pointer" (click)="editar(element.nLote, element.nSubLote, 2)"><i-tabler
                    name="edit" class="icon-18"></i-tabler></a>
              </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
          </table>
          <mat-paginator #paginatorExterno [pageSizeOptions]="[5, 15, 20]" showFirstLastButtons></mat-paginator>
        </div>
      </mat-tab>

      <mat-tab label="Sobres Internos" class="f-s-16 f-w-600">
        <div class="table-responsive">
          <table mat-table [dataSource]="dataSourceInternos" class="w-100">
            <ng-container matColumnDef="subLote">
              <th mat-header-cell *matHeaderCellDef class="f-s-16 f-w-600">N° SubLote</th>
              <td mat-cell *matCellDef="let element">
                <div>
                  <p class="mat-subtitle-1 f-s-14 m-t-0">
                    {{ element.nSubLote }}
                  </p>
                </div>
              </td>
            </ng-container>

            <ng-container matColumnDef="observacion">
              <th mat-header-cell *matHeaderCellDef class="f-s-16 f-w-600">
                Observación
              </th>
              <td mat-cell *matCellDef="let element" class="f-s-14">{{ element.observacion }}</td>
            </ng-container>

            <ng-container matColumnDef="estado">
              <th mat-header-cell *matHeaderCellDef class="f-s-16 f-w-600">
                Estado
              </th>
              <td mat-cell *matCellDef="let element" class="f-s-14">
                {{ element.estado }}
              </td>
            </ng-container>

            <ng-container matColumnDef="opciones">
              <th mat-header-cell *matHeaderCellDef class="f-s-16 f-w-600">
                Opciones
              </th>
              <td mat-cell *matCellDef="let element" class="action-link">
                <!-- <a class="m-r-10 cursor-pointer"><i-tabler name="qrcode" class="icon-18"></i-tabler></a> -->
                <a class="m-r-10 cursor-pointer" (click)="editar(element.nLote, element.nSubLote, 2)"><i-tabler
                    name="edit" class="icon-18"></i-tabler></a>
              </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns2"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns2"></tr>
          </table>
          <mat-paginator #paginatorInterno [pageSizeOptions]="[5, 15, 20]" showFirstLastButtons></mat-paginator>
        </div>
      </mat-tab>

    </mat-tab-group>

  </mat-card-content>
</mat-card>

<!-- guarda dependiendo del sobre escaneado -->

<mat-card class="cardWithShadow" *ngIf="data.opcion === 2">
  <h2 mat-dialog-title>Sobres del Lote: {{ referencia || "Cargando..." }}</h2>
  <mat-card-content class="p-24">
    <!-- Formulario para actualizar los valores del sobre -->
    <form [formGroup]="form" (ngSubmit)="onSubmit()">
      <div class="col-12 mb-3">

        <div class="row">
          <div class="col-md-6 col-sm-12 mb-3">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>SubLote</mat-label>
              <input matInput readonly formControlName="nSubLote" required />

            </mat-form-field>
          </div>

          <div class="col-md-6 col-sm-12 mb-3">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>Fecha Instrucción Despacho</mat-label>
              <input matInput [matDatepicker]="picker1" formControlName="fechaInstruccionDespacho" required />
              <mat-datepicker-toggle matIconSuffix [for]="picker1"></mat-datepicker-toggle>
              <mat-datepicker #picker1></mat-datepicker>

            </mat-form-field>
          </div>
        </div>

        <div class="row">
          <div class="col-md-6 col-sm-12 mb-3">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>Dus</mat-label>
              <input matInput formControlName="DUS" required />

            </mat-form-field>
          </div>

          <div class="col-md-6 col-sm-12 mb-3">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>Fecha DUS</mat-label>
              <input matInput [matDatepicker]="picker3" formControlName="fechaDUS" required />
              <mat-datepicker-toggle matIconSuffix [for]="picker3"></mat-datepicker-toggle>
              <mat-datepicker #picker3></mat-datepicker>

            </mat-form-field>
          </div>
        </div>

        <div class="row">
          <div class="col-md-6 col-sm-12 mb-3">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>Fecha Confirmación Despacho</mat-label>
              <input matInput [matDatepicker]="picker2" formControlName="fechaConfirmacionDespacho" required />
              <mat-datepicker-toggle matIconSuffix [for]="picker2"></mat-datepicker-toggle>
              <mat-datepicker #picker2></mat-datepicker>

            </mat-form-field>
          </div>

          <div class="col-md-6 col-sm-12 mb-3">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>Fecha Despacho</mat-label>
              <input matInput [matDatepicker]="picker4" formControlName="fechaDespacho" required />
              <mat-datepicker-toggle matIconSuffix [for]="picker4"></mat-datepicker-toggle>
              <mat-datepicker #picker4></mat-datepicker>

            </mat-form-field>
          </div>
        </div>

        <div class="row">
          <div class="col-md-6 col-sm-12 mb-3">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>N° de Guía</mat-label>
              <input matInput formControlName="numeroGuia" required />

            </mat-form-field>
          </div>

          <div class="col-md-6 col-sm-12 mb-3">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>Observación</mat-label>
              <textarea matInput formControlName="observacion" required rows="4"></textarea>

            </mat-form-field>
          </div>
        </div>

        <div class="row">
          <div class="col-md-6 col-sm-12 mb-3">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>Laboratorio</mat-label>
              <input matInput formControlName="laboratorio" required />

            </mat-form-field>
          </div>

          <div class="col-md-6 col-sm-12 mb-3">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>Fecha llegada a Laboratorio</mat-label>
              <input matInput [matDatepicker]="picker5" formControlName="fechaLlegadaLaboratorio" required />
              <mat-datepicker-toggle matIconSuffix [for]="picker5"></mat-datepicker-toggle>
              <mat-datepicker #picker5></mat-datepicker>

            </mat-form-field>
          </div>
        </div>

        <div class="row">
          <div class="col-md-6 col-sm-12 mb-3">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>País</mat-label>
              <input matInput formControlName="pais" required />

            </mat-form-field>
          </div>

          <div class="col-md-6 col-sm-12 mb-3">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>Estado</mat-label>
              <input matInput formControlName="estado" />
            </mat-form-field>
          </div>
        </div>

      </div>
    </form>
  </mat-card-content>
  <mat-card-actions class="d-flex justify-content-center">
    <button mat-raised-button class="m-r-10" color="primary" type="submit" (click)="onSubmit()">
      Guardar
    </button>
    <button mat-raised-button class="m-l-10" color="warn" type="button" (click)="onClose()">
      Cancelar
    </button>
  </mat-card-actions>
</mat-card>